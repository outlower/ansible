# Ansible Role: UrBackup Client

Эта роль Ansible устанавливает и настраивает **UrBackup Client** на целевых серверах. 

## Функциональность

- Копирование установочного файла **UrBackup Client** на целевой сервер.
- Установка клиента из локального файла.
- Автоматическое принятие всех запросов во время установки.
- Настройка параметров клиента в файле `/etc/default/urbackupclient`.
- Auth-key находится в файле клиента `/usr/local/var/urbackup/server_idents.txt`.
 TF=$(mktemp) && wget "https://hndl.urbackup.org/Client/2.5.25/UrBackup%20Client%20Linux%202.5.25.sh" -O $TF && sudo sh $TF; rm -f $TF

 /dev/mapper/ubuntu--vg-ubuntu--lv


# Ansible Role: Restic Backup

## Описание

Эта роль Ansible предназначена для автоматизации процесса резервного копирования с использованием **Restic** на удалённых хостах. Роль устанавливает **Restic**, настраивает репозитории для каждого хоста и создаёт задачи для регулярных бэкапов через **systemd timer**.

## Структура роли

1. **Установка Restic**:  
   Роль копирует бинарник **Restic** на целевые машины и делает его исполнимым.

2. **Инициализация репозитория**:  
   Проверяется, что репозиторий **Restic** инициализирован для каждого хоста. Если нет — выполняется инициализация.

3. **Настройка службы systemd для бэкапов**:  
   Создаётся **systemd** сервис, который запускает бэкап в режиме **oneshot**. Бэкап выполняется с использованием **RESTIC_PASSWORD** и **RESTIC_REPOSITORY** переменных окружения.

4. **Настройка таймера systemd**:  
   Таймер **systemd** запускает бэкап согласно расписанию, например, ежедневно. Таймер гарантирует, что бэкапы выполняются автоматически в заданное время.

5. **Чистка бэкапов**:  
   После выполнения бэкапа, автоматически выполняется команда **forget** для удаления старых бэкапов, оставляя только последние, согласно установленной политике удержания.

## Переменные

Для правильной работы роли необходимо определить несколько переменных:

```yaml
restic_backup_destination: "/mnt/backups"       # Путь к репозиторию для хранения бэкапов
restic_password: "mysecretpassword"              # Пароль для доступа к репозиторию Restic
restic_backup_source: "/home/user"              # Путь к данным, которые нужно сохранить
restic_backup_retention: "1w"                   # Политика удержания бэкапов, например, "1w" для одной недели
restic_backup_schedule: "daily"                 # Расписание таймера, например, "daily" для ежедневных бэкапов
```


## Список часто используемых команд

```yaml
restic snapshots	                                    Показать список всех сохранённых снапшотов
restic backup /path/to/dir	                            Выполнить бэкап указанного пути
restic restore <snapshot-id> --target /restore/dir	    Восстановить снапшот в указанную директорию
restic forget --keep-daily 7 --keep-weekly 4 --prune	Удалить старые бэкапы по политике хранения и очистить
restic check	                                        Проверить целостность репозитория
restic mount /mnt/restic	                            Смонтировать снапшоты как FUSE-файловую систему (удобно для ручного просмотра)
restic ls <snapshot-id>	                                Посмотреть содержимое конкретного снапшота
restic diff <snapshot1> <snapshot2>	                    Посмотреть разницу между двумя снапшотами
```

## Все команды требуют **--repo** и **пароль** (или переменную окружения **RESTIC_PASSWORD**).